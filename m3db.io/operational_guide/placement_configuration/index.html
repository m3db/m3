



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-0.17.3, mkdocs-material-2.7.3">
    
    
      
        <title>Placement/Topology Configuration - M3 Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.8d40d89b.css">
      
    
    
      <script src="../../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <a href="#placement-configuration" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="M3 Documentation" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                M3 Documentation
              </span>
              <span class="md-header-nav__topic">
                Placement/Topology Configuration
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/m3db/m3/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      m3db/m3
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <span class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </span>
    M3 Documentation
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/m3db/m3/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      m3db/m3
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Overview
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Overview
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../introduction/components/components/" title="Components" class="md-nav__link">
      Components
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../introduction/motivation/motivation/" title="Motivation" class="md-nav__link">
      Motivation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../introduction/media/media/" title="Media" class="md-nav__link">
      Media
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      M3DB
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        M3DB
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../m3db/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-2" type="checkbox" id="nav-3-2">
    
    <label class="md-nav__link" for="nav-3-2">
      Architecture
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-2">
        Architecture
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../m3db/architecture/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../m3db/architecture/engine/" title="Storage Engine" class="md-nav__link">
      Storage Engine
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../m3db/architecture/sharding/" title="Sharding and Replication" class="md-nav__link">
      Sharding and Replication
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../m3db/architecture/consistencylevels/" title="Consistency Levels" class="md-nav__link">
      Consistency Levels
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../m3db/architecture/storage/" title="Storage" class="md-nav__link">
      Storage
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../m3db/architecture/commitlogs/" title="Commit Logs" class="md-nav__link">
      Commit Logs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../m3db/architecture/peer_streaming/" title="Peer Streaming" class="md-nav__link">
      Peer Streaming
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../m3db/architecture/caching/" title="Caching" class="md-nav__link">
      Caching
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Query Engine and Coordinator
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Query Engine and Coordinator
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../query_engine/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../query_engine/roadmap/" title="Roadmap" class="md-nav__link">
      Roadmap
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4-3" type="checkbox" id="nav-4-3">
    
    <label class="md-nav__link" for="nav-4-3">
      Architecture
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-4-3">
        Architecture
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../query_engine/architecture/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../query_engine/architecture/blocks/" title="Blocks" class="md-nav__link">
      Blocks
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../query_engine/architecture/functions/" title="Function Processing" class="md-nav__link">
      Function Processing
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      How-To's
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        How-To's
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../how_to/single_node/" title="M3DB Single Node Deployment" class="md-nav__link">
      M3DB Single Node Deployment
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../how_to/cluster_hard_way/" title="M3DB Cluster Deployment, Manually" class="md-nav__link">
      M3DB Cluster Deployment, Manually
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../how_to/kubernetes/" title="M3DB on Kubernetes" class="md-nav__link">
      M3DB on Kubernetes
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6" checked>
    
    <label class="md-nav__link" for="nav-6">
      Operational Guides
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Operational Guides
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../placement/" title="Placement/Topology" class="md-nav__link">
      Placement/Topology
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Placement/Topology Configuration
      </label>
    
    <a href="./" title="Placement/Topology Configuration" class="md-nav__link md-nav__link--active">
      Placement/Topology Configuration
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" title="Overview" class="md-nav__link">
    Overview
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#understanding-the-placement-configuration" title="Understanding the Placement Configuration" class="md-nav__link">
    Understanding the Placement Configuration
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#id" title="ID" class="md-nav__link">
    ID
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#isolation-group" title="Isolation Group" class="md-nav__link">
    Isolation Group
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zone" title="Zone" class="md-nav__link">
    Zone
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#weight" title="Weight" class="md-nav__link">
    Weight
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#endpoint" title="Endpoint" class="md-nav__link">
    Endpoint
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hostname" title="Hostname" class="md-nav__link">
    Hostname
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#port" title="Port" class="md-nav__link">
    Port
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#placement-operations" title="Placement Operations" class="md-nav__link">
    Placement Operations
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#placement-initialization" title="Placement Initialization" class="md-nav__link">
    Placement Initialization
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-a-node" title="Adding a Node" class="md-nav__link">
    Adding a Node
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#removing-a-node" title="Removing a Node" class="md-nav__link">
    Removing a Node
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#replacing-a-node" title="Replacing a Node" class="md-nav__link">
    Replacing a Node
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../namespace_configuration/" title="Namespace Configuration" class="md-nav__link">
      Namespace Configuration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../bootstrapping/" title="Bootstrapping" class="md-nav__link">
      Bootstrapping
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../kernel_configuration/" title="Kernel Configuration" class="md-nav__link">
      Kernel Configuration
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Integrations
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Integrations
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../integrations/prometheus/" title="Prometheus" class="md-nav__link">
      Prometheus
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../troubleshooting/" title="Troubleshooting" class="md-nav__link">
      Troubleshooting
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../faqs/" title="FAQs" class="md-nav__link">
      FAQs
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" title="Overview" class="md-nav__link">
    Overview
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#understanding-the-placement-configuration" title="Understanding the Placement Configuration" class="md-nav__link">
    Understanding the Placement Configuration
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#id" title="ID" class="md-nav__link">
    ID
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#isolation-group" title="Isolation Group" class="md-nav__link">
    Isolation Group
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zone" title="Zone" class="md-nav__link">
    Zone
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#weight" title="Weight" class="md-nav__link">
    Weight
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#endpoint" title="Endpoint" class="md-nav__link">
    Endpoint
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hostname" title="Hostname" class="md-nav__link">
    Hostname
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#port" title="Port" class="md-nav__link">
    Port
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#placement-operations" title="Placement Operations" class="md-nav__link">
    Placement Operations
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#placement-initialization" title="Placement Initialization" class="md-nav__link">
    Placement Initialization
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-a-node" title="Adding a Node" class="md-nav__link">
    Adding a Node
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#removing-a-node" title="Removing a Node" class="md-nav__link">
    Removing a Node
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#replacing-a-node" title="Replacing a Node" class="md-nav__link">
    Replacing a Node
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/m3db/m3/edit/master/docs/operational_guide/placement_configuration.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="placement-configuration">Placement Configuration</h1>
<h2 id="overview">Overview</h2>
<p>M3DB was designed from the ground up to be a distributed (clustered) database that is availability zone or rack aware (by using isolation groups). Clusters will seamlessly scale with your data, and you can start with a small number of nodes and grow it to a size of several hundred nodes with no downtime or expensive migrations.</p>
<p>Before reading the rest of this document, we recommend familiarizing yourself with the <a href="../placement/">M3DB placement documentation</a></p>
<p><strong>Note</strong>: The primary limiting factor for the maximum size of an M3DB cluster is the number of shards. Picking an appropriate number of shards is more of an art than a science, but our recommendation is as follows:</p>
<ul>
<li>Resource Constrained / Development clusters: <code>64 shards</code></li>
<li>Production clusters: <code>1024 shards</code></li>
<li>Production clusters with high-resource nodes (Over 128GiB of ram, etc) and an expected cluster size of several hundred nodes: <code>4096 shards</code></li>
</ul>
<p>After performing any of the instructions documented below a new placement will automatically be generated to distribute the shards among the M3DB nodes such that the isolation group and replication factor constraints are met.</p>
<p>If the constraints cannot be met, because there are not enough nodes to calculate a new placement such that each shard is replicated on the desired number of nodes with none of the nodes owning the same shard existing in the same isolation group, then the operation will fail.</p>
<p>In other words, all you have to do is issue the desired instruction and the M3 stack will take care of making sure that your data is distributed with appropriate replication and isolation.</p>
<p>In the case of the M3DB nodes, nodes that have received new shards will immediately begin receiving writes (but not serving reads) for the new shards that they are responsible for. They will also begin streaming in all the data for their newly acquired shards from the peers that already have data for those shards. Once the nodes have finished streaming in the data for the shards that they have acquired, they will mark their status for those shards as <code>Available</code> in the placement and begin accepting writes. Simultaneously, the nodes that are losing ownership of any shards will mark their status for those shards as <code>Leaving</code>. Once all the nodes accepting ownership of the new shards have finished streaming data from them, they will relinquish ownership of those shards and remove all the data associated with the shards they lost from memory and from disk.</p>
<p>M3Coordinator nodes will also pickup the new placement from etcd and alter which M3DB nodes they issue writes and reads to appropriately.</p>
<h3 id="understanding-the-placement-configuration">Understanding the Placement Configuration</h3>
<p>The placement configuration contains a few core values that control how the placement behaves.</p>
<h4 id="id">ID</h4>
<p>This is the identifier for a node in the placement and can be any value that uniquely identifies an M3DB node.</p>
<h4 id="isolation-group">Isolation Group</h4>
<p>This value controls how nodes that own the same M3DB shards are isolated from each other. For example, in a single datacenter configuration this value could be set to the rack that the M3DB node lives on. As a result, the placement will guarantee that nodes that exist on the same rack do not share any shards, allowing the cluster to survive the failure of an entire rack. Alternatively, if M3DB was deployed in an AWS region, the isolation group could be set to the region's availability zone and that would ensure that the cluster would survive the loss of an entire availability zone.</p>
<h4 id="zone">Zone</h4>
<p>This value controls what etcd zone the M3DB node belongs to.</p>
<h4 id="weight">Weight</h4>
<p>This value should be an integer and controls how the cluster will weigh the number of shards that an individual node will own. If you're running the M3DB cluster on homogenous hardware, then you probably want to assign all M3DB nodes the same weight so that shards are distributed evenly. On the otherhand, if you're running the cluster on heterogenous hardware, then this value should be higher for nodes with higher resources for whatever the limiting factor is in your cluster setup. For example, if disk space (as opposed to memory or CPU) is the limiting factor in how many shards any given node in your cluster can tolerate, then you could assign a higher value to nodes in your cluster that have larger disks and the placement calculations would assign them a higher number of shards.</p>
<h4 id="endpoint">Endpoint</h4>
<p>This value should be in the form of <M3DB_HOST_NAME>:<M3DB_NODE_LISTEN_PORT> and identifies how network requests should be routed to this particular node in the placement.</p>
<h4 id="hostname">Hostname</h4>
<p>This value should be in the form of <M3DB_HOST_NAME> and identifies the address / host name of the M3DB node.</p>
<h4 id="port">Port</h4>
<p>This value should be in the form of <M3DB_NODE_LISTEN_PORT> and identifies the port over which this M3DB node expects to receive traffic (defaults to 9000).</p>
<h3 id="placement-operations">Placement Operations</h3>
<p>The instructions below all contain sample curl commands, but you can always review the API documentation by navigating to</p>
<p><code>http://&lt;M3_COORDINATOR_HOST_NAME&gt;:&lt;CONFIGURED_PORT(default 7201)&gt;/api/v1/openapi</code> or our <a href="https://m3db.io/openapi/">online API documentation</a>.</p>
<p><strong>Note</strong>: The <a href="../bootstrapping/">peers bootstrapper</a> must be configured on all nodes in the M3DB cluster for placement changes to work. The <code>peers</code> bootstrapper is enabled by default, so you only need to worry about this if you modified the default bootstrapping configuration</p>
<h4 id="placement-initialization">Placement Initialization</h4>
<p>Send a POST request to the <code>/api/v1/services/m3db/placement/init</code> endpoint</p>
<pre><code class="bash">curl -X POST localhost:7201/api/v1/services/m3db/placement/init -d '{
    &quot;num_shards&quot;: &lt;DESIRED_NUMBER_OF_SHARDS&gt;,
    &quot;replication_factor&quot;: &lt;DESIRED_REPLICATION_FACTOR&gt;(recommended 3),
    &quot;instances&quot;: [
        {
            &quot;id&quot;: &quot;&lt;NODE_1_ID&gt;&quot;,
            &quot;isolation_group&quot;: &quot;&lt;NODE_1_ISOLATION_GROUP&gt;&quot;,
            &quot;zone&quot;: &quot;&lt;ETCD_ZONE&gt;&quot;,
            &quot;weight&quot;: &lt;NODE_WEIGHT&gt;,
            &quot;endpoint&quot;: &quot;&lt;NODE_1_HOST_NAME&gt;:&lt;NODE_1_PORT&gt;&quot;,
            &quot;hostname&quot;: &quot;&lt;NODE_1_HOST_NAME&gt;&quot;,
            &quot;port&quot;: &lt;NODE_1_PORT&gt;
        },
        {
            &quot;id&quot;: &quot;&lt;NODE_2_ID&gt;&quot;,
            &quot;isolation_group&quot;: &quot;&lt;NODE_2_ISOLATION_GROUP&gt;&quot;,
            &quot;zone&quot;: &quot;&lt;ETCD_ZONE&gt;&quot;,
            &quot;weight&quot;: &lt;NODE_WEIGHT&gt;,
            &quot;endpoint&quot;: &quot;&lt;NODE_2_HOST_NAME&gt;:&lt;NODE_2_PORT&gt;&quot;,
            &quot;hostname&quot;: &quot;&lt;NODE_2_HOST_NAME&gt;&quot;,
            &quot;port&quot;: &lt;NODE_2_PORT&gt;
        },
        {
            &quot;id&quot;: &quot;&lt;NODE_3_ID&gt;&quot;,
            &quot;isolation_group&quot;: &quot;&lt;NODE_3_ISOLATION_GROUP&gt;&quot;,
            &quot;zone&quot;: &quot;&lt;ETCD_ZONE&gt;&quot;,
            &quot;weight&quot;: &lt;NODE_WEIGHT&gt;,
            &quot;endpoint&quot;: &quot;&lt;NODE_3_HOST_NAME&gt;:&lt;NODE_3_PORT&gt;&quot;,
            &quot;hostname&quot;: &quot;&lt;NODE_3_HOST_NAME&gt;&quot;,
            &quot;port&quot;: &lt;NODE_3_PORT&gt;
        },
    ]
}'
</code></pre>

<h4 id="adding-a-node">Adding a Node</h4>
<p>Send a POST request to the <code>/api/v1/services/m3db/placement</code> endpoint</p>
<pre><code class="bash">curl -X POST &lt;M3_COORDINATOR_HOST_NAME&gt;:&lt;M3_COORDINATOR_PORT(default 7201)&gt;/api/v1/services/m3db/placement -d '{
  &quot;instances&quot;: [
    {
      &quot;id&quot;: &quot;&lt;NEW_NODE_ID&gt;&quot;,
      &quot;isolationGroup&quot;: &quot;&lt;NEW_NODE_ISOLATION_GROUP&gt;&quot;,
      &quot;zone&quot;: &quot;&lt;ETCD_ZONE&gt;&quot;,
      &quot;weight&quot;: &lt;NODE_WEIGHT&gt;,
      &quot;endpoint&quot;: &quot;&lt;NEW_NODE_HOST_NAME&gt;:&lt;NEW_NODE_PORT&gt;(default 9000)&quot;,
      &quot;hostname&quot;: &quot;&lt;NEW_NODE_HOST_NAME&gt;&quot;,
      &quot;port&quot;: &lt;NEW_NODE_PORT&gt;
    }
  ]
}'
</code></pre>

<p>After sending the add command you will need to wait for the M3DB cluster to reach the new desired state. You'll know that this has been achieved when the placement shows that all shards for all hosts are in the <code>Available</code> state.</p>
<h4 id="removing-a-node">Removing a Node</h4>
<p>Send a DELETE request to the <code>/api/v1/services/m3db/placement/&lt;NODE_ID&gt;</code> endpoint.</p>
<pre><code class="bash">curl -X DELETE &lt;M3_COORDINATOR_HOST_NAME&gt;:&lt;M3_COORDINATOR_PORT(default 7201)&gt;/api/v1/services/m3db/placement/&lt;NODE_ID&gt;
</code></pre>

<p>After sending the delete command you will need to wait for the M3DB cluster to reach the new desired state. You'll know that this has been achieved when the placement shows that all shards for all hosts are in the <code>Available</code> state.</p>
<h4 id="replacing-a-node">Replacing a Node</h4>
<p>Send a POST request to the <code>/api/v1/services/m3db/placement/replace</code> endpoint containing hosts to replace and candidates to replace it with.</p>
<pre><code class="bash">curl -X POST &lt;M3_COORDINATOR_HOST_NAME&gt;:&lt;M3_COORDINATOR_PORT(default 7201)&gt;/api/v1/services/m3db/placement/replace -d '{
    &quot;leavingInstanceIDs&quot;: [&quot;&lt;OLD_NODE_ID&gt;&quot;],
    &quot;candidates&quot;: [
        {
          &quot;id&quot;: &quot;&lt;NEW_NODE_ID&gt;&quot;,
          &quot;isolationGroup&quot;: &quot;&lt;NEW_NODE_ISOLATION_GROUP&gt;&quot;,
          &quot;zone&quot;: &quot;&lt;ETCD_ZONE&gt;&quot;,
          &quot;weight&quot;: &lt;NODE_WEIGHT&gt;,
          &quot;endpoint&quot;: &quot;&lt;NEW_NODE_HOST_NAME&gt;:&lt;NEW_NODE_PORT&gt;(default 9000)&quot;,
          &quot;hostname&quot;: &quot;&lt;NEW_NODE_HOST_NAME&gt;&quot;,
          &quot;port&quot;: &lt;NEW_NODE_PORT&gt;
        }
    ]
}'
</code></pre>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../placement/" title="Placement/Topology" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Placement/Topology
              </span>
            </div>
          </a>
        
        
          <a href="../namespace_configuration/" title="Namespace Configuration" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Namespace Configuration
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="http://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.b438e6c5.js"></script>
      
      <script>app.initialize({version:"0.17.3",url:{base:"../.."}})</script>
      
    
    
      
    
  </body>
</html>