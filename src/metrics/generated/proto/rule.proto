syntax = "proto3";
package schema;

import "policy.proto";

message MappingRuleSnapshot {
  string name = 1;
  bool tombstoned = 2;
  int64 cutover_time = 3;
  map<string,string> tag_filters = 4;
  repeated Policy policies = 5;
}

message MappingRule {
  string uuid = 1;
  repeated MappingRuleSnapshot snapshots = 2;
}

message RollupTarget {
  string name = 1;
  repeated string tags = 2;
  repeated Policy policies = 3;
}

message RollupRuleSnapshot {
  string name = 1;
  bool tombstoned = 2;
  int64 cutover_time = 3;
  map<string,string> tag_filters = 4;
  repeated RollupTarget targets = 5;
}

message RollupRule {
  string uuid = 1;
  repeated RollupRuleSnapshot snapshots = 2;
}

message RuleSet {
  string uuid = 1;
  string namespace = 2;
  int64 created_at = 3;
  int64 last_updated_at = 4;
  bool tombstoned = 5;
  int64 cutover_time = 6;
  repeated MappingRule mapping_rules = 7;
  repeated RollupRule rollup_rules = 8;
}

message Namespace {
  string name = 1;
  bool tombstoned = 2;
  int64 expire_at = 3;
}

message Namespaces {
  repeated Namespace namespaces = 1;
}
